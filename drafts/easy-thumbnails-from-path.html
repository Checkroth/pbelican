
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/pygments/colorful.min.css">
  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/font-awesome/css/solid.css">

    <link href="https://checkroth.com/static/custom.css" rel="stylesheet">




<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-136401999-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#FFFFFF">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#FFFFFF">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#FFFFFF">

<meta name="author" content="Charles Heckroth" />
<meta name="description" content="The Problem easy_thumbnails is a handy library for automatically resizing &amp; storing various sizes of an image. As the name implies, it is an easy way to create thumbnails for images in your django project so you don&#39;t have to use massive original-size images for tiny thumbnail displays. It does however …" />
<meta name="keywords" content="python, django, filestorage">

<meta property="og:site_name" content="software-and-stuff"/>
<meta property="og:title" content="Django Easy Thumbnailer URLs from Filepaths"/>
<meta property="og:description" content="The Problem easy_thumbnails is a handy library for automatically resizing &amp; storing various sizes of an image. As the name implies, it is an easy way to create thumbnails for images in your django project so you don&#39;t have to use massive original-size images for tiny thumbnail displays. It does however …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://checkroth.com/drafts/easy-thumbnails-from-path.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-10-21 00:00:00+09:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://checkroth.com/author/charles-heckroth.html">
<meta property="article:section" content="blog"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="django"/>
<meta property="article:tag" content="filestorage"/>
<meta property="og:image" content="/images/me.jpg">

  <title>software-and-stuff &ndash; Django Easy Thumbnailer URLs from Filepaths</title>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-3090577057275093",
      enable_page_level_ads: true
    });
  </script>
</head>
<body>
  <aside>
    <div>
      <a href="https://checkroth.com">
        <img src="/images/me.jpg" alt="Charles Henry Heckroth" title="Charles Henry Heckroth">
      </a>
      <h1><a href="https://checkroth.com">Charles Henry Heckroth</a></h1>

<p>My Notes & Blog</p>
      <nav>
        <ul class="list">
          <li><a href="https://checkroth.com/pages/about-me.html">About Me</a></li>

          <li><a href="https://checkroth.com/category/blog.html" target="_blank">Blog</a></li>
          <li><a href="https://drive.google.com/file/d/1HLklPEKD8CMGnUfddLsOewxYlIfioJxq/view" target="_blank">Resume</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-envelope" href="mailto:checkroth@gmail.com" target="_blank">
            <i class="fas fa-envelope">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://www.github.com/Checkroth" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/charlesheckroth" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-twitter" href="http://www.twitter.com/checkroth" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-stack-overflow" href="https://stackoverflow.com/users/1037971/charles" target="_blank">
            <i class="fab fa-stack-overflow">
            </i>
          </a></li>
      </ul>
    </div>

      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle ads-aside"
           data-ad-client="ca-pub-3090577057275093"
           data-ad-slot="7734708573"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

  </aside>
  <main>

    <nav>
      <a href="https://checkroth.com">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="easy-thumbnails-from-path">Django Easy Thumbnailer URLs from Filepaths</h1>
    <p>
          Posted on October 21, 2020 in <a href="https://checkroth.com/category/blog.html">blog</a>


    </p>
  </header>


  <div>
    <h1 id="the-problem">The Problem</h1>
<p><a href="https://github.com/SmileyChris/easy-thumbnails">easy_thumbnails</a> is a handy library for automatically resizing &amp; storing various sizes of an image. As the name implies, it is an easy way to create thumbnails for images in your django project so you don't have to use massive original-size images for tiny thumbnail displays.</p>
<p>It does however come with its problems, particularly with the amount of queries it executes. It's handy for processing single instances, but when you have a list of hundreds of objects the use of easy_thumbnail's template filters is going to throw out <em>a lot</em> of unnecessary queries. At least one, often more than one, for every object. This is going to make page rendering painfully slow, so it should be avoided.</p>
<p>In django you would generally avoid this by using features like <code>prefetch_related</code> and <code>values_list</code> to get the information you need in one go, but you can't use easy_thumbnail's features with these standard Django ORM functions. </p>
<p>So if you want to get a list of the urls for a thumbnail size for a model, given a model like:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ThumbnailerImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s2">"images/"</span><span class="p">)</span>
</pre></div>
<p>You would have to get your thumbanils like this:</p>
<div class="highlight"><pre><span></span><span class="n">thumbnails</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_thumbnailer</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">image</span><span class="p">)[</span><span class="s1">'mysize'</span><span class="p">]</span><span class="o">.</span><span class="n">rul</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
</pre></div>
<p>But that's going to execute a query for every object and is no better than just using the built-in template filter.</p>
<p>And <code>MyModel.objects.values_list('image', flat=True)</code> is only going to give you the name of each image -- not the object you need for using easy_thumbnails <code>get_thumbnailer</code>.</p>
<p>So <em>how can we get a list of thumbnail URLs</em>?</p>
<h1 id="the-solution">The Solution</h1>
<p>To get a list of thumbnail urls without executing a query for each instance of your object, you need to trick easy_thumbnails in to <em>thinking</em> it has an instance of each object, when really you just have a list of file names.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easy_thumbnails.files</span> <span class="kn">import</span> <span class="n">ThumbnailerImageFieldFile</span>
<span class="kn">from</span> <span class="nn">easy_thumbnails.files</span> <span class="kn">import</span> <span class="n">get_thumbnailer</span>

<span class="n">throwaway_object</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>

<span class="n">thumbnails</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_thumbnailer</span><span class="p">(</span><span class="n">ThumbnailerImageFieldFile</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">throwaway_object</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="n">throwaway_object</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">filename</span><span class="p">))[</span><span class="s1">'size'</span><span class="p">]</span><span class="o">.</span><span class="n">url</span>
              <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">MyObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">'image'</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://checkroth.com/tag/python.html">python</a>
      <a href="https://checkroth.com/tag/django.html">django</a>
      <a href="https://checkroth.com/tag/filestorage.html">filestorage</a>
    </p>
  </div>




    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="ca-pub-3090577057275093"
         data-ad-slot="6895080254"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'checkroth';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>
  &copy;  2021 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " software-and-stuff ",
  "url" : "https://checkroth.com",
  "image": "/images/me.jpg",
  "description": "Blog and info"
}
</script>

</body>
</html>