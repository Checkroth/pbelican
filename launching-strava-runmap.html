
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/pygments/colorful.min.css">
  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://checkroth.com/theme/font-awesome/css/solid.css">

    <link href="https://checkroth.com/static/custom.css" rel="stylesheet">




<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-136401999-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#FFFFFF">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#FFFFFF">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#FFFFFF">

<meta name="author" content="Charles Heckroth" />
<meta name="description" content="I lifted a neat activity visualization from my colleague James Van Dyne (with permission), an re-implemented it as a Pelican plugin to mix in with my site, and make it easy for others to do the same. The Visualization The visualization is a neat thing that my colleague James Van …" />
<meta name="keywords" content="pelican, python, strava">

<meta property="og:site_name" content="software-and-stuff"/>
<meta property="og:title" content="Strava Runmap: A new Pelican Plugin"/>
<meta property="og:description" content="I lifted a neat activity visualization from my colleague James Van Dyne (with permission), an re-implemented it as a Pelican plugin to mix in with my site, and make it easy for others to do the same. The Visualization The visualization is a neat thing that my colleague James Van …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://checkroth.com/launching-strava-runmap.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2024-08-04 00:00:00+09:00"/>
<meta property="article:modified_time" content="2024-08-04 00:00:00+09:00"/>
<meta property="article:author" content="https://checkroth.com/author/charles-heckroth.html">
<meta property="article:section" content="blog"/>
<meta property="article:tag" content="pelican"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="strava"/>
<meta property="og:image" content="/images/me2.jpeg">

  <title>software-and-stuff &ndash; Strava Runmap: A new Pelican Plugin</title>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-3090577057275093",
      enable_page_level_ads: true
    });
  </script>
</head>
<body>
  <aside>
    <div>
      <a href="https://checkroth.com">
        <img src="/images/me2.jpeg" alt="Charles Henry Heckroth" title="Charles Henry Heckroth">
      </a>
      <h1><a href="https://checkroth.com">Charles Henry Heckroth</a></h1>

<p>My Notes & Blog</p>
      <nav>
        <ul class="list">
          <li><a href="https://checkroth.com/pages/about-me.html">About Me</a></li>
          <li><a href="https://checkroth.com/pages/strava-runmap.html">Strava Runmap</a></li>

          <li><a href="https://checkroth.com/category/blog.html" target="_blank">Blog</a></li>
          <li><a href="https://drive.google.com/file/d/1T80kxtu-rTTqWSHAqkLZAsEqcBnmXwFK/view?usp=sharing" target="_blank">Resume</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-envelope" href="mailto:checkroth@gmail.com" target="_blank">
            <i class="fas fa-envelope">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://www.github.com/Checkroth" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/charlesheckroth" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-twitter" href="http://www.twitter.com/checkroth" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-stack-overflow" href="https://stackoverflow.com/users/1037971/charles" target="_blank">
            <i class="fab fa-stack-overflow">
            </i>
          </a></li>
      </ul>
    </div>

      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle ads-aside"
           data-ad-client="ca-pub-3090577057275093"
           data-ad-slot="7734708573"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

  </aside>
  <main>

    <nav>
      <a href="https://checkroth.com">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="launching-strava-runmap">Strava Runmap: A new Pelican Plugin</h1>
    <p>
          Posted on August 04, 2024 in <a href="https://checkroth.com/category/blog.html">blog</a>


    </p>
  </header>


  <div>
    <p>I lifted a neat activity visualization from my colleague James Van Dyne (with permission), an re-implemented it as a Pelican plugin to mix in with my site, and make it easy for others to do the same.</p>
<h1 id="the-visualization">The Visualization</h1>
<p>The visualization is a neat thing that my colleague James Van Dyne did <a href="https://jamesvandyne.com/runs/">on his Tanzawa Blog</a>.</p>
<p>It uses the python package <a href="https://pypi.org/project/polyline/">polyline</a>, and takes coordinate data from the <a href="https://developers.strava.com/docs/reference/">strava api</a> to turn them in to the little line maps.</p>
<p>I have (with permission) lifted this implementation almost entirely as-is from James's <a href="https://github.com/jamesvandyne/tanzawa">Tanzawa</a>. I haven't done any of the heavy lifting myself on these visualizations, just adapted them to my plugin.</p>
<h1 id="the-plugin">The Plugin</h1>
<p><a href="https://github.com/Checkroth/strava-runmap">Strava Runmap</a> is a pelican plugin. It has yet to be adopted in to the official <a href="official">pelican plugins</a>. Implementation and configuration details can</p>
<p>There are three main parts:</p>
<h2 id="1-integration-with-the-strava-api">1: Integration with the Strava API</h2>
<p>The plugin will, every time you build your pelican site, authenticate with the Strava API and pull every activitity you have ever recorded. It's not particularly performant and will probably slow down your build process.</p>
<p>I only have a few hundred activities (I don't exercise that much and didn't start using Strava until a couple years ago). This process might be unbearable for some users of the plugin, sorry.</p>
<h2 id="2-polyline-svg-generation">2: Polyline svg generation</h2>
<p>The part explained above. Once we have strava activities, we turn them in to SVGs represented in python strings.</p>
<p>These are stored in a context that keeps the svg data and other relevant metadata from Strava, and groups them by year (for display purposes)</p>
<h2 id="3-page-generation">3: Page Generation</h2>
<p>Once we have all the SVG and related metadata, we generate a full "content" section to include in a pelican page, and inject that page in to the list using a hook in to pelican's pages generator.</p>
<p>The page content is at this moment, raw HTML built with a little bit of python. The styles are minimal (just flexbox for layout and a little bit of styling), and are all written in-line, in strings, in python.</p>
<h1 id="temporary-usage-until-its-published_1">Temporary Usage Until Its Published</h1>
<p>It has yet to be published on pypi or adopted in to pelican plugins -- there are a few dangling tasks for the plugin in general. This means it cannot be installed normally as a pelican plugin without a small bit of tinkering:</p>
<ol>
<li>Include the repository as a git submodule in your <code>plugins</code> directory.</li>
<li>Include the path to the nested repository's plugins directory in your plugin_paths ( <code>PLUGIN_PATHS = ['plugins', 'plugins/strava-runmap/pelican/plugins']</code> )</li>
<li>Configure the plugin, as instructed in the <a href="https://github.com/Checkroth/strava-runmap/blob/main/README.md">readme</a></li>
</ol>
<h1 id="what-didnt-work">What Didn't Work</h1>
<p>There were a few things I sort of tried, and failed to find a solution (at least, not one that I was willing to spend the time working on):</p>
<ol>
<li>Not fetching <em>every</em> activy - I played around with the idea of keeping some sort of cache, and using that to filter the request to the strava API. I couldn't find out a reliable way to do that filtering or caching, at least not very easily.</li>
<li>Storing SVG files as actual static files: I tried to hook in to pelican's staticfiles generator to add the SVGs as actual files, and reference them in the new page. I could not figure out how to pipe raw content in to a staticfile for pelican though -- it crossed my mind to use <code>tempfiles</code>, but the context between the tempfile being created and pelican actually trying to access them was also troublesome to deal with.</li>
<li>Using real templates: I am building <a href="https://github.com/Checkroth/strava-runmap/blob/main/pelican/plugins/strava_runmap/strava_runmap.py#L36">raw html in python strings</a> to inject as page content that will eventually be inserted in to a pelican template. I would have preferred for the plugin to define its <em>own</em> template and use a more sensible approach, but struggled to find a way to actually do that.</li>
</ol>
<p>All of the above are certainly <em>possible</em>, and maybe even necessary (especially the staticfiles part -- if somebody has thousands of strava actiities, the resulting page might just be too large as a single asset). I am open to contributions directly in strava-runmap :)</p>
<h1 id="next-steps">Next Steps</h1>
<p>These can be seen in the <a href="https://github.com/getpelican/pelican-plugins/issues/1405">issue for incorporating it in pelican plugins</a></p>
<ol>
<li>Fix the build</li>
<li>Improve the tests</li>
<li>Get adopted as a pelican plugin</li>
<li>Publis to pypi</li>
<li>Implement a few features we're missing -- like more control over what the page actually looks like, and the ability to include the run contexts in other pages freely for anybody using the plugin.</li>
</ol>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://checkroth.com/tag/pelican.html">pelican</a>
      <a href="https://checkroth.com/tag/python.html">python</a>
      <a href="https://checkroth.com/tag/strava.html">strava</a>
    </p>
  </div>




    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="ca-pub-3090577057275093"
         data-ad-slot="6895080254"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'checkroth';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>
  &copy;  2021 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " software-and-stuff ",
  "url" : "https://checkroth.com",
  "image": "/images/me2.jpeg",
  "description": "Blog and info"
}
</script>

</body>
</html>